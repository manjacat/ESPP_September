@model IEnumerable<eSPP.Models.TransaksiModels>
<div class="well">
	<fieldset>
		<div class="widget-body no-padding">
			<div class="modal fade" id="EditBonusModal" tabindex="-1" role="dialog">
				<div class="modal-dialog">
					<div class="modal-content">
						<div id='EditBonusModalContent'></div>
					</div>
				</div>
			</div>
			<table id="datatable_tabletools" class="table table-striped table-bordered table-hover" width="100%">
				<thead>
					<tr>
						<th width="1%" style="text-align:center" align="center">#</th>
						<th width="3%" style="text-align:center" align="center">No. Pekerja</th>
						<th width="10%" id="near" style="text-align:center" align="center">Nama Pekerja</th>
						<th width="5%" style="text-align:center" align="center">No. K/P</th>
						<th width="5%" style="text-align:center" align="center">No. Akaun</th>
						<th width="5%" style="text-align:center" align="center">No. Kwsp</th>
						<th width="5%" style="text-align:center" align="center">Tarikh Lantikan</th>
						@{ var no = 0; }
						@while (ViewBag.max > no)
						{
							no++;
							<th width="1%" style="text-align:center" align="center">@no</th>
						}
						<th width="1%" style="text-align:center" align="center">Total (RM)</th>
						<th width="1%" style="text-align:center" align="center">Purata (RM)</th>
						<th width="1%" style="text-align:center" align="center">Bonus Diterima (RM)</th>
						<th width="5%" style="text-align:center" align="center">Tindakan</th>
					</tr>
				</thead>
				<tbody>
					@{ var i = 0; }
					@foreach (var item in Model)
					{
						i++;
						ViewBag.icount = i;
						<tr>
							<td width="1%">
								@ViewBag.icount
							</td>
							<td width="3%">
								@item.peribadi.HR_NO_PEKERJA
							</td>
							<td id="near2">
								@item.peribadi.HR_NAMA_PEKERJA
							</td>
							<td width="5%">
								@item.peribadi.HR_NO_KPBARU
							</td>
							<td width="5%">
								@item.peribadi.HR_MAKLUMAT_PEKERJAAN.HR_NO_AKAUN_BANK
							</td>
							<td width="5%">
								@item.peribadi.HR_MAKLUMAT_PEKERJAAN.HR_NO_KWSP
							</td>
                            <td width="5%">
                                @if(item.peribadi.HR_MAKLUMAT_PEKERJAAN.HR_TARIKH_LANTIKAN != null)
                                {
                                    item.peribadi.HR_MAKLUMAT_PEKERJAAN.HR_TARIKH_LANTIKAN.Value.ToString("dd/MM/yyyy");
                                }
                            </td>
							@{ var no2 = 0; }
							@while (ViewBag.max > no2)
							{
								List<HR_TRANSAKSI_SAMBILAN_DETAIL> listdetail = ViewBag.column;
								no2++;
								List<HR_TRANSAKSI_SAMBILAN_DETAIL> transaksidetail = listdetail.Where(s => s.HR_NO_PEKERJA == item.peribadi.HR_NO_PEKERJA && s.HR_BULAN_DIBAYAR == no2).ToList();
								if (transaksidetail.Count > 0)
								{
									foreach (var item1 in transaksidetail)
									{
										<td width="1%">@item1.HR_JUMLAH</td>
									}
								}
								else
								{
									<td width="1%">0.00</td>
								}
							}
							<td width="1%">
								@item.TOTAL
							</td>
							<td width="1%">
								@item.PURATA
							</td>
							<td width="1%">
								@item.BONUS
							</td>
							<td align="center" width="1%">
								<div class="btn-group col-12">
									<a class="btn btn-xs btn-default btn-circle EditBonus" href="javascript:void(0)" data-id="@item.BONUS" title="Edit Transaksi"><i class="fa fa-edit"></i></a>
								</div>
							</td>
						</tr>
						}
				</tbody>
			</table>
		</div>
	</fieldset>
</div>
	<script>
		$(document).ready(function () {
			var responsiveHelper_datatable_tabletools = undefined;

			var breakpointDefinition = {
				tablet: 1024,
				phone: 480
			};

			$('#datatable_tabletools').dataTable({
				responsive: true,
				// Tabletools options:
				//   https://datatables.net/extensions/tabletools/button_options
				"sDom": "<'dt-toolbar'<'col-xs-12 col-sm-6'f><'col-sm-6 col-xs-6 hidden-xs'T>r>" +
						"t" +
						"<'dt-toolbar-footer'<'col-sm-6 col-xs-12 hidden-xs'i><'col-sm-6 col-xs-12'p>>",
				"oTableTools": {
					"aButtons": [
					"copy",
					"csv",
					"xls",
					   {
					   	"sExtends": "pdf",
					   	"sTitle": "SmartAdmin_PDF",
					   	"sPdfMessage": "SmartAdmin PDF Export",
					   	"sPdfSize": "letter"
					   },
					   {
					   	"sExtends": "print",
					   	"sMessage": "Generated by SmartAdmin <i>(press Esc to close)</i>"
					   }
					],
					"sSwfPath": "/Scripts/plugin/datatables/swf/copy_csv_xls_pdf.swf"
				},
				"autoWidth": true,

				"preDrawCallback": function () {
					// Initialize the responsive datatables helper once.
					if (!responsiveHelper_datatable_tabletools) {
						responsiveHelper_datatable_tabletools = new ResponsiveDatatablesHelper($('#datatable_tabletools'), breakpointDefinition);
					}
				},
				"rowCallback": function (nRow) {
					responsiveHelper_datatable_tabletools.createExpandIcon(nRow);
				},
				"drawCallback": function (oSettings) {
					responsiveHelper_datatable_tabletools.respond();
				}
			});
			$('div.tambah').after('<a name="btn_add" class="btn btn-success pull-right hidden-mobile" href=@Url.Action("TransaksiSambilan", "PengurusanKakitanganSambilan") ><span style="color:#FFF"><span class="fa fa-plus"></span> Tambah</span></a>');
			$('div.muktamad').after('<a name="btn_muktamad" class="btn btn-warning pull-right hidden-mobile" href=@Url.Action("MuktamadAll", "PengurusanKakitanganSambilan") ><span style="color:#FFF"><span class="fa fa-send"></span> Muktamad</span></a>');
		})

		var EditBonus = '../PengurusanKakitanganSambilan/EditBonus';
		$(function () {
			debugger;
			$(".EditBonus").click(function () {
				var $buttonClicked = $(this);
				var id = $buttonClicked.attr('data-id');
				var options = { "backdrop": "static", keyboard: true };
				$.ajax({
					type: "GET",
					url: EditBonus,
					contentType: "application/json; charset=utf-8",
					data: { "id": id },
					datatype: "json",
					success: function (data) {
						$('#EditBonusModalContent').html(data);
						$('#EditBonusModal').modal(options);
						$('#EditBonusModal').modal('show');
					},
					error: function () {
						alert("Dynamic content load failed.");
					}
				});
			});
			$("#closbtn").click(function () {
				$('#EditBonusModal').modal('hide');
			});
		});

	</script>

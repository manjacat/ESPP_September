@model IEnumerable<eSPP.Models.AgreementModels>

@if (ViewBag.StatusMessage == "Data Berjaya Dimuktamadkan. Tiada Lagi Sebarang Perubahan Boleh Dilakukan.")
{
	<div class="alert adjusted alert-success fade in">
		<button class="close" data-dismiss="alert">
			×
		</button>
		<i class="fa-fw fa-lg fa fa-warning"></i>
		<strong>Muktamad</strong> @ViewBag.StatusMessage
	</div>
}
    <div class="well">
        @if (Model != null)
        {
            <fieldset>
                <div class="widget-body no-padding">
                    <table id="datatable_tabletools" class="table table-striped table-bordered table-hover" width="100%">
                        <thead>
                            <tr>
                                <th width="1%">#</th>
                                <th width="10%">No. Pekerja</th>
                                <th>Nama Pekerja</th>
                                <th width="1%">Tindakan</th>

                            </tr>
                        </thead>
                        <tbody>

                            @{ var i = 0; }
                            @foreach (var item in Model)
                            {
                                @Html.Hidden("bulantahunbekerja")
                                @Html.Hidden("bulantahundibayar")

                                i++;
                                ViewBag.icount = i;
                                <tr>

                                    <td>
                                        @ViewBag.icount
                                    </td>
                                    <td>
                                        @item.HR_NO_PEKERJA
                                    </td>
                                    <td>
                                        @item.HR_NAMA_PEKERJA
                                    </td>
                                    <td align="center">
                                        <div class="btn-group col-12">
                                            @if (item.MUKTAMAD == 0)
                                            {
                                                <a class="btn btn-xs btn-default btn-circle" title="Kemaskini"
                                                   href='@Url.Action("Sejarah", "KakitanganSambilan",
                                                new { HR_PEKERJA = item.HR_NO_PEKERJA,
                                                    tahunbekerja = item.LIST_HR_TAHUN,
                                                    bulanbekerja = item.LIST_HR_BULAN_BEKERJA,
                                                    tahundibayar = item.LIST_HR_TAHUN_DIBAYAR,
                                                    bulandibayar = item.LIST_HR_BULAN_DIBAYAR })'><i class="fa fa-money"></i></a>
                                            }
                                            else if (item.MUKTAMAD == 1)
                                            {
                                                <button class="btn btn-xs btn-default btn-circle" disabled title="Transaksi Sambilan"><i class="fa fa-money"></i></button>
                                            }
                                        </div>
                                    </td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
            </fieldset>
        }
    </div>
	<script>
		$(document).ready(function () {
			var responsiveHelper_datatable_tabletools = undefined;

			var breakpointDefinition = {
				tablet: 1024,
				phone: 480
			};

			$('#datatable_tabletools').dataTable({
				responsive: true,
				// Tabletools options:
				//   https://datatables.net/extensions/tabletools/button_options
				"sDom": "<'dt-toolbar'<'col-xs-12 col-sm-6'f><'col-sm-6 col-xs-6 hidden-xs'T<'muktamad'><'tambah'>>r>" +
						"t" +
						"<'dt-toolbar-footer'<'col-sm-6 col-xs-12 hidden-xs'i><'col-sm-6 col-xs-12'p>>",
				"oTableTools": {
					"aButtons": [
					"copy",
					"csv",
					"xls",
					   {
					   	"sExtends": "pdf",
					   	"sTitle": "SmartAdmin_PDF",
					   	"sPdfMessage": "SmartAdmin PDF Export",
					   	"sPdfSize": "letter"
					   },
					   {
					   	"sExtends": "print",
					   	"sMessage": "Generated by SmartAdmin <i>(press Esc to close)</i>"
					   }
					],
					"sSwfPath": "/Scripts/plugin/datatables/swf/copy_csv_xls_pdf.swf"
				},
				"autoWidth": true,

				"preDrawCallback": function () {
					// Initialize the responsive datatables helper once.
					if (!responsiveHelper_datatable_tabletools) {
						responsiveHelper_datatable_tabletools = new ResponsiveDatatablesHelper($('#datatable_tabletools'), breakpointDefinition);
					}
				},
				"rowCallback": function (nRow) {
					responsiveHelper_datatable_tabletools.createExpandIcon(nRow);
				},
				"drawCallback": function (oSettings) {
					responsiveHelper_datatable_tabletools.respond();
				}
			});

			$('div.tambah').after('<a name="btn_add" class="btn btn-success pull-right hidden-mobile" href=@Url.Action("Sejarah", "KakitanganSambilan") ><span style="color:#FFF"><span class="fa fa-plus"></span> Tambah</span></a>');
			$('div.muktamad').after('<a name="btn_muktamad" id="btn_muktamad" class="btn btn-warning pull-right hidden-mobile"><span style="color:#FFF"><span class="fa fa-plus"></span> Muktamad</span></a>');
		})

		$(function () {
			$("#btn_muktamad").on("click", function () {
                ConfirmMe();
			});
        })

        function MuktamadAll() {
            debugger;
            $.ajax({
                url: "../../PengurusanKakitanganSambilan/MuktamadAll",
                data: { "bulantahundari": $("input[name='bulantahunbekerja']").val(), "bulantahunsehingga": $("input[name='bulantahundibayar']").val() },
                contentType: "application/json; charset=utf-8",
                type: 'GET',
                success: function (data) {
                    $("#showtable").html(data)
                }
            })
        }

        //edit Transaksi Kakitangan sambilan
		var EditBonus = '../../PengurusanKakitanganSambilan/EditBonus';
		$(function () {
			$(".EditBonus").click(function () {
				var $buttonClicked = $(this);
				var id = $buttonClicked.attr('data-id');
				var options = { "backdrop": "static", keyboard: true };
				$.ajax({
					type: "GET",
					url: EditBonus,
					contentType: "application/json; charset=utf-8",
					data: { "id": id },
					datatype: "json",
					success: function (data) {
						$('#EditBonusModalContent').html(data);
						$('#EditBonusModal').modal(options);
						$('#EditBonusModal').modal('show');
					},
					error: function () {
						alert("Dynamic content load failed.");
					}
				});
			});
			$("#closbtn").click(function () {
				$('#EditBonusModal').modal('hide');
			});
        });

        //confirmation modal utk Muktamad all
        function ConfirmMe() {
            $.confirm({
                title: 'Muktamad',
                content: 'Anda pasti hendak muktamad semua transaksi sambilan?',
                buttons: {
                    Muktamad: function () {
                        //$.alert('Pasti');
                        MuktamadAll();
                    },
                    Kembali: function () {
                        console.log('cancelled');
                    }                    
                }
            });
            //TODO            
        }

	</script>

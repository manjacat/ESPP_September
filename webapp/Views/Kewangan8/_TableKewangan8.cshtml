@model IEnumerable<eSPP.Models.PergerakanGajiModels>

<fieldset style="padding-top:5px; padding-bottom:5px">
    <legend>Senarai Gaji Bulanan</legend>
    <table id="datatable_tabletools" class="table table-striped table-bordered table-hover" width="100%">
        <thead>
            <tr>
                <th>#</th>
                <th data-class="expand" width="30%">Butir Perubahan</th>
                <th>Catatan</th>
                <th>Tarikh Mula</th>
                <th>Tarikh Akhir</th>
                <th data-hide="phone">No Surat Kebenaran</th>
                <th data-hide="phone,tablet">Status</th>
                <th data-hide="phone,tablet">Id Kew8</th>
                <th>Pilih</th>
            </tr>
        </thead>
        <tbody>
            @{ var no = 0;}
            @foreach (PergerakanGajiModels item in Model)
            {
                no++;
                var txt = "Tidak Aktif";
                var color = "label-danger";
                <tr>
                    <td align="center">@no</td>
                    <td><a class="Info" id="Info" href="javascript:void(0)" data-id="@item.HR_KEW8_ID" data-kodperubahan="@item.HR_KOD_PERUBAHAN" data-tarikh="@item.HR_TARIKH_MULA" title="Info">@Html.DisplayFor(model => item.HR_BUTIR_PERUBAHAN)</a></td>
                    <td>@Html.DisplayFor(model => item.HR_CATATAN)</td>
                    <td align="center">@string.Format("{0:dd/MM/yyyy}", item.HR_TARIKH_MULA)</td>
                    <td align="center">@string.Format("{0:dd/MM/yyyy}", item.HR_TARIKH_AKHIR)</td>
                    <td>@Html.DisplayFor(model => item.HR_NO_SURAT_KEBENARAN)</td>
                    <td>
                        @if(item.HR_FINALISED_IND_HR == "Y")
                        {
                            txt = "Muktamat";
                            color = "label-success";
                        }
                        else if(item.HR_FINALISED_IND_HR == "P")
                        {
                            txt = "Proses";
                            color = "label-warning";
                        }
                        else if (item.HR_FINALISED_IND_HR == "T")
                        {
                            txt = "Tidak Aktif";
                            color = "label-danger";
                        }
                         <span class="center-block padding-5 label @color">
                             @txt
                         </span>
                    </td>
                    <td>@item.HR_KEW8_ID</td>
                    <td>
                        @if (item.HR_FINALISED_IND_HR == "Y")
                        {
                            <a class="btn btn-default btn-xs" data-id="@item.HR_KEW8_ID" data-kodperubahan="@item.HR_KOD_PERUBAHAN" data-tarikh="@item.HR_TARIKH_MULA" title="Kemaskini" disabled ="disabled"><i class="fa fa-edit"></i></a>
                            <a class="btn btn-default btn-xs" data-id="@item.HR_KEW8_ID" data-kodperubahan="@item.HR_KOD_PERUBAHAN" data-tarikh="@item.HR_TARIKH_MULA" title="Padam" disabled ="disabled"><i class="fa fa-trash-o"></i></a>
                        }
                        else
                        {
                            <a class="btn btn-default btn-xs Edit" id="Edit" href="javascript:void(0)" data-id="@item.HR_KEW8_ID" data-kodperubahan="@item.HR_KOD_PERUBAHAN" data-tarikh="@item.HR_TARIKH_MULA" title="Kemaskini"><i class="fa fa-edit"></i></a>
                            <a class="btn btn-default btn-xs Padam" id="Padam" href="javascript:void(0)" data-id="@item.HR_KEW8_ID" data-kodperubahan="@item.HR_KOD_PERUBAHAN" data-tarikh="@item.HR_TARIKH_MULA" title="Padam"><i class="fa fa-trash-o"></i></a>
                        }
                        
                    </td>
                </tr>
            }
        </tbody>
    </table>

</fieldset>
<script>

    $(document).ready(function () {
        var responsiveHelper_datatable_tabletools = undefined;

        var breakpointDefinition = {
            tablet: 1024,
            phone: 480
        };

        $('#datatable_tabletools').dataTable({
            responsive: true,
            // Tabletools options:
            //   https://datatables.net/extensions/tabletools/button_options
            "sDom": "<'dt-toolbar'<'col-xs-12 col-sm-6'f><'col-sm-6 col-xs-6 hidden-xs'lT<'.btn-add'>>r>" +
                    "t" +
                    "<'dt-toolbar-footer'<'col-sm-6 col-xs-12 hidden-xs'i><'col-sm-6 col-xs-12'p>>",
            "oTableTools": {
                "aButtons": [
                "copy",
                "csv",
                "xls",
                   {
                       "sExtends": "pdf",
                       "sTitle": "SmartAdmin_PDF",
                       "sPdfMessage": "SmartAdmin PDF Export",
                       "sPdfSize": "letter"
                   },
                   {
                       "sExtends": "print",
                       "sMessage": "Generated by SmartAdmin <i>(press Esc to close)</i>"
                   }
                ],
                "sSwfPath": "/Scripts/plugin/datatables/swf/copy_csv_xls_pdf.swf"
            },
            "autoWidth": true,

            "preDrawCallback": function () {
                // Initialize the responsive datatables helper once.
                if (!responsiveHelper_datatable_tabletools) {
                    responsiveHelper_datatable_tabletools = new ResponsiveDatatablesHelper($('#datatable_tabletools'), breakpointDefinition);
                }
            },
            "rowCallback": function (nRow) {
                responsiveHelper_datatable_tabletools.createExpandIcon(nRow);
            },
            "drawCallback": function (oSettings) {
                responsiveHelper_datatable_tabletools.respond();
            }
        });
        $("div.btn-add").html('<div class="text-right"><button type = "button" name = "Tambah" id = "Tambah" class = "btn btn-success Tambah"><i class = "fa fa-plus"></i></button></div>');

        $(".modal-dialog").css("min-width", "40%");

        var Tambah = '../Kewangan8/TambahKewangan8';
        $(function () {
            $("#Tambah").on("click", function () {
                //var $buttonClicked = $(this);
                //var HR_NO_PEKERJA = $buttonClicked.attr('data-id');
                var options = { "backdrop": "static", keyboard: true };
                $.ajax({
                    type: "GET",
                    url: Tambah,
                    contentType: "application/json; charset=utf-8",
                    data: { "HR_NO_PEKERJA": '@ViewBag.id' },
                    datatype: "json",
                    success: function (data) {
                        $('#ModalContent').html(data);
                        $('#Modal').modal(options);
                        $('#Modal').modal('show');
                    },
                    error: function () {
                        alert("Dynamic content load failed.");
                    }
                });
            });
        });

        var Info = '../Kewangan8/InfoKewangan8';
        $(function () {
            $("#datatable_tabletools").on("click", "#Info", function () {
                var $buttonClicked = $(this);
                var HR_KEW8_ID = $buttonClicked.attr('data-id');
                var HR_KOD_PERUBAHAN = $buttonClicked.attr('data-kodperubahan');
                var HR_TARIKH_MULA = $buttonClicked.attr('data-tarikh');
                var options = { "backdrop": "static", keyboard: true };
                $.ajax({
                    type: "GET",
                    url: Info,
                    contentType: "application/json; charset=utf-8",
                    data: { "HR_NO_PEKERJA": '@ViewBag.id', "HR_KEW8_ID": HR_KEW8_ID, "HR_KOD_PERUBAHAN": HR_KOD_PERUBAHAN, "HR_TARIKH_MULA": HR_TARIKH_MULA },
                    datatype: "json",
                    success: function (data) {
                        $('#ModalContent').html(data);
                        $('#Modal').modal(options);
                        $('#Modal').modal('show');
                    },
                    error: function () {
                        alert("Dynamic content load failed.");
                    }
                });
            });
        });

        var Edit = '../Kewangan8/EditKewangan8';
        $(function () {
            $("#datatable_tabletools").on("click", "#Edit", function () {
                var $buttonClicked = $(this);
                var HR_KEW8_ID = $buttonClicked.attr('data-id');
                var HR_KOD_PERUBAHAN = $buttonClicked.attr('data-kodperubahan');
                var HR_TARIKH_MULA = $buttonClicked.attr('data-tarikh');
                var options = { "backdrop": "static", keyboard: true };
                $.ajax({
                    type: "GET",
                    url: Edit,
                    contentType: "application/json; charset=utf-8",
                    data: { "HR_NO_PEKERJA": '@ViewBag.id', "HR_KEW8_ID": HR_KEW8_ID, "HR_KOD_PERUBAHAN": HR_KOD_PERUBAHAN, "HR_TARIKH_MULA": HR_TARIKH_MULA },
                    datatype: "json",
                    success: function (data) {
                        $('#ModalContent').html(data);
                        $('#Modal').modal(options);
                        $('#Modal').modal('show');
                    },
                    error: function () {
                        alert("Dynamic content load failed.");
                    }
                });
            });
        });

        var Padam = '../Kewangan8/PadamKewangan8';
        $(function () {
            $("#datatable_tabletools").on("click", "#Padam", function () {
                var $buttonClicked = $(this);
                var HR_KEW8_ID = $buttonClicked.attr('data-id');
                var HR_KOD_PERUBAHAN = $buttonClicked.attr('data-kodperubahan');
                var HR_TARIKH_MULA = $buttonClicked.attr('data-tarikh');
                var options = { "backdrop": "static", keyboard: true };
                $.ajax({
                    type: "GET",
                    url: Padam,
                    contentType: "application/json; charset=utf-8",
                    data: { "HR_NO_PEKERJA": '@ViewBag.id', "HR_KEW8_ID": HR_KEW8_ID, "HR_KOD_PERUBAHAN": HR_KOD_PERUBAHAN, "HR_TARIKH_MULA": HR_TARIKH_MULA },
                    datatype: "json",
                    success: function (data) {
                        $('#ModalContent').html(data);
                        $('#Modal').modal(options);
                        $('#Modal').modal('show');
                    },
                    error: function () {
                        alert("Dynamic content load failed.");
                    }
                });
            });
        });
        $('#Modal').on('hidden.bs.modal', function () {
            $(this).find('#ModalContent').html("");
        });
    })
</script>

